<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Keep existing head content -->
  <style>
    /* Add these fixes */
    .cg-page, .el-page { display: none; }
    .cg-page.active, .el-page.active { display: block; }
    #medicineFormCG .time-slot { margin-bottom: 1rem; }
    .medicine-image-preview { max-width: 100px; margin-right: 0.5rem; }
  </style>
</head>
<body class="min-h-screen">
  <!-- Landing Page (keep existing) -->

  <!-- Caregiver Profile Section -->
  <div id="caregiverProfile" class="hidden">
    <!-- Navigation (keep existing) -->
    <div class="max-w-4xl mx-auto p-6">
      <!-- Caregiver Pages -->
      <div id="cgHome" class="cg-page">
        <!-- Add home page content -->
        <div class="card p-6 mb-8">
          <h3 class="text-2xl font-semibold mb-4">Recent Activity</h3>
          <div id="caregiverActivityLog"></div>
        </div>
      </div>
      
      <!-- Enhanced Medicine Reminder Section -->
      <div id="cgMedicine" class="cg-page hidden">
        <div class="card p-6 mb-8">
          <h3 class="text-2xl font-semibold mb-4">Scheduled Medications</h3>
          <div id="caregiverRemindersList" class="grid gap-4 md:grid-cols-2"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Elder Profile Section -->
  <div id="elderProfile" class="hidden">
    <!-- Navigation (keep existing) -->
    <div class="max-w-4xl mx-auto p-6">
      <!-- Enhanced Elder Medicine View -->
      <div id="elMedicine" class="el-page hidden">
        <div class="card p-6">
          <div id="elderRemindersList" class="space-y-4"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Fixed initialization
    let remindersCG = [];
    let remindersEL = [];
    let activityLog = [];

    // Unified Reminder Manager
    class ReminderSystem {
      static addReminder(role, data) {
        const reminder = {
          id: Date.now(),
          ...data,
          status: 'active',
          history: []
        };
        
        if(role === 'caregiver') {
          remindersCG.push(reminder);
          remindersEL.push({...reminder}); // Clone for elder
        }
        this.updateViews();
      }

      static updateViews() {
        this.renderCaregiverReminders();
        this.renderElderReminders();
        this.renderActivityLog();
      }

      static renderCaregiverReminders() {
        const container = document.getElementById('caregiverRemindersList');
        container.innerHTML = remindersCG.map(rem => `
          <div class="card p-4">
            <h4 class="font-bold text-lg">${rem.medicineName}</h4>
            <p>Dosage: ${rem.pillCount} pills</p>
            ${rem.images.map(img => `
              <img src="${img}" class="medicine-image-preview" />
            `).join('')}
            <div class="mt-2 text-sm text-gray-600">
              ${rem.timeSlots.map(slot => `
                <p>${slot.start} - ${slot.end}</p>
              `).join('')}
            </div>
          </div>
        `).join('');
      }

      static renderElderReminders() {
        const container = document.getElementById('elderRemindersList');
        container.innerHTML = remindersEL.map(rem => `
          <div class="card p-4">
            <h4 class="text-xl font-bold">${rem.medicineName}</h4>
            <button onclick="ReminderSystem.markTaken(${rem.id})" 
              class="bg-green-500 text-white px-4 py-2 mt-2 rounded">
              Mark as Taken
            </button>
          </div>
        `).join('');
      }

      static markTaken(id) {
        const now = new Date();
        const reminder = remindersCG.find(r => r.id === id);
        if(reminder) {
          reminder.history.push({
            timestamp: now.toISOString(),
            status: 'taken'
          });
          activityLog.push({
            type: 'medication',
            message: `${reminder.medicineName} marked as taken`,
            timestamp: now
          });
          this.updateViews();
        }
      }

      static renderActivityLog() {
        const logContainer = document.getElementById('caregiverActivityLog');
        logContainer.innerHTML = activityLog.map(entry => `
          <div class="log-entry">
            <span class="text-sm">[${new Date(entry.timestamp).toLocaleTimeString()}]</span>
            ${entry.message}
          </div>
        `).join('');
      }
    }

    // Fixed Event Listeners
    document.getElementById('medicineFormCG').addEventListener('submit', function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      
      const timeSlots = Array.from(document.querySelectorAll('#medicineFormCG .time-slot')).map(slot => {
        return {
          start: slot.querySelector('.startTime').value,
          end: slot.querySelector('.endTime').value
        };
      });

      const images = Array.from(formData.getAll('medicineImagesCG')).map(file => {
        return URL.createObjectURL(file);
      });

      ReminderSystem.addReminder('caregiver', {
        medicineName: formData.get('medicineNameCG'),
        pillCount: formData.get('pillCountCG'),
        frequency: formData.get('frequencyCG'),
        timeSlots,
        images
      });

      this.reset();
    });

    // Initialize default views
    ReminderSystem.updateViews();
  </script>
</body>
</html>
